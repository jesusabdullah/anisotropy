% COMSOL Multiphysics Model M-file
% Generated by COMSOL 3.5a (COMSOL 3.5.0.608, $Date: 2009/05/11 07:38:49 $)

flclear fem

% COMSOL version
clear vrsn
vrsn.name = 'COMSOL 3.5';
vrsn.ext = 'a';
vrsn.major = 0;
vrsn.build = 608;
vrsn.rcs = '$Name: v35ap $';
vrsn.date = '$Date: 2009/05/11 07:38:49 $';
fem.version = vrsn;

% Geometry
g1=sphere3('0.4','pos',{'0','0','0'},'axis',{'0','0','1'},'rot','0');
g2=cylinder3('0.00025','0.1','pos',{'-0.05','0','0'},'axis',{'1','0','0'},'rot','15');

% Geometry objects
clear s
s.objs={g1,g2};
s.name={'SNOW','NEEDLE'};
s.tags={'g1','g2'};

fem.draw=struct('s',s);

% (Default values are not included)

% Application mode 1
clear appl
appl.mode.class = 'GeneralHeat';
appl.module = 'HT';
appl.assignsuffix = '_htgh';
clear prop
prop.analysis='static';
appl.prop = prop;
clear bnd
bnd.dw = {};
bnd.Cs = {};
bnd.type = {};
bnd.radType = {};
bnd.hclOn = {};
bnd.dwplus = {};
bnd.dwType = {};
bnd.name = {};
bnd.J0amb = {};
bnd.rhos = {};
bnd.epsilon = {};
bnd.q0 = {};
bnd.Tw = {};
bnd.ds = {};
bnd.ks = {};
bnd.Tamb = {};
bnd.dres = {};
bnd.groupSurf = {};
bnd.J0surf = {};
bnd.T0 = {};
bnd.k0 = {};
bnd.Tinf = {};
bnd.h = {};
bnd.kres = {};
bnd.ind = [];
appl.bnd = bnd;
clear equ
equ.eta = {};
equ.QpworkOn = {};
equ.delsd = {};
equ.cdtypesystem = {};
equ.srcpnt = {};
equ.S0 = {};
equ.gporder = {};
equ.coordOn = {};
equ.etaT = {};
equ.sdtype = {};
equ.pA = {};
equ.opacity = {};
equ.idon = {};
equ.rho = {};
equ.PrTmodel = {};
equ.cporder = {};
equ.init = {};
equ.Stype = {};
equ.R0 = {};
equ.cdon = {};
equ.stabElmType = {};
equ.PrT = {};
equ.sdon = {};
equ.Cgammatype = {};
equ.srcaxis = {};
equ.Sd = {};
equ.C = {};
equ.QviscOn = {};
equ.matterstate = {};
equ.Mn = {};
equ.Rs = {};
equ.gamma = {};
equ.Q = {};
equ.name = {};
equ.qs = {};
equ.glim = {};
equ.rOn = {};
equ.dr = {};
equ.usedElement = {};
equ.convOn = {};
equ.ReInf = {};
equ.usesGMG = {};
equ.delid = {};
equ.k = {};
equ.RsMntype = {};
equ.w = {};
equ.v = {};
equ.u = {};
equ.pwformulation = {};
equ.usage = {};
equ.finestMCelem = {};
equ.usesELM = {};
equ.user = {};
equ.ind = [];
appl.equ = equ;
fem.appl{1} = appl;
fem.sdim = {'x','y','z'};
fem.frame = {'ref'};
fem.border = 1;
fem.outform = 'general';
clear units;
units.basesystem = 'SI';
fem.units = units;

% ODE Settings
clear ode
clear units;
units.basesystem = 'SI';
ode.units = units;
fem.ode=ode;

% Multiphysics
fem=multiphysics(fem);

% COMSOL Multiphysics Model M-file
% Generated by COMSOL 3.5a (COMSOL 3.5.0.608, $Date: 2009/05/11 07:38:49 $)

% Geometry
parr={point3(0,0,0)};
g3=geomcoerce('point',parr);
parr={point3(0.4,0,0)};
g4=geomcoerce('point',parr);
parr={point3(0,0.4,0)};
g5=geomcoerce('point',parr);
parr={point3(0,0,0.4)};
g6=geomcoerce('point',parr);
parr={point3(-0.4,0,0)};
g7=geomcoerce('point',parr);
parr={point3(0,-0.4,0)};
g8=geomcoerce('point',parr);
parr={point3(0,0,-0.4)};
g9=geomcoerce('point',parr);

% Geometry objects
clear p s
p.objs={g3,g4,g5,g6,g7,g8,g9};
p.name={'ORIGIN','PT1','PT2','PT3','PT4','PT5','PT6'};
p.tags={'g3','g4','g5','g6','g7','g8','g9'};

s.objs={g1,g2};
s.name={'SNOW','NEEDLE'};
s.tags={'g1','g2'};

fem.draw=struct('p',p,'s',s);

% COMSOL Multiphysics Model M-file
% Generated by COMSOL 3.5a (COMSOL 3.5.0.608, $Date: 2009/05/11 07:38:49 $)

% Geometry

% Analyzed geometry
clear p s
p.objs={g3,g4,g5,g6,g7,g8,g9};
p.name={'ORIGIN','PT1','PT2','PT3','PT4','PT5','PT6'};
p.tags={'g3','g4','g5','g6','g7','g8','g9'};

s.objs={g1,g2};
s.name={'SNOW','NEEDLE'};
s.tags={'g1','g2'};

fem.draw=struct('p',p,'s',s);
fem.geom=geomcsg(fem);

% Initialize mesh
fem.mesh=meshinit(fem, ...
                  'hauto',5);

% (Default values are not included)

% Application mode 1
clear appl
appl.mode.class = 'GeneralHeat';
appl.module = 'HT';
appl.shape = {'shlag(1,''J'')','shlag(2,''T'')'};
appl.sshape = 2;
appl.assignsuffix = '_htgh';
clear bnd
bnd.type = {'q0','cont'};
bnd.shape = 1;
bnd.ind = [1,1,1,1,2,2,2,2,2,1,1,1,1,2];
appl.bnd = bnd;
clear equ
equ.sdtype = 'gls';
equ.rho = {200,8000};
equ.shape = 2;
equ.C = {2050,460};
equ.Q = {0,6.355e5};
equ.k = {{0.1;0.2;0.3},160};
equ.ind = [1,2];
appl.equ = equ;
fem.appl{1} = appl;
fem.frame = {'ref'};

% Shape functions
fem.shape = {'shlag(2,''T'')'};

% Integration order
fem.gporder = {4,0};

% Constraint order
fem.cporder = {2,1};
fem.border = 1;
fem.outform = 'general';

% Equation form
fem.form = 'general';
clear units;
units.basesystem = 'SI';
fem.units = units;

% Subdomain settings
clear equ
equ.dweak = 'dVol_htgh*rho_htgh*C_htgh*Tt*test(T)';
equ.weak = {'dVol_htgh*(-kxx_htgh*TSx_htgh*test(TSx_htgh)-kyy_htgh*TSy_htgh*test(TSy_htgh)-kzz_htgh*TSz_htgh*test(TSz_htgh))', ...
  'dVol_htgh*(-k_htgh*TSx_htgh*test(TSx_htgh)-k_htgh*TSy_htgh*test(TSy_htgh)-k_htgh*TSz_htgh*test(TSz_htgh)+Q_htgh*test(T))'};
equ.ind = [1,2];
equ.dim = {'T'};
equ.var = {'gradT_htgh','sqrt(abs(Tx)^2+abs(Ty)^2+abs(Tz)^2)', ...
  'k_htgh',{'','kxx_htgh'}, ...
  'kmean_htgh',{'(kxx_htgh+kyy_htgh+kzz_htgh)/3','k_htgh'}, ...
  'da_htgh','rho_htgh*C_htgh', ...
  'cflux_x_htgh',0, ...
  'beta_x_htgh',0, ...
  'dflux_x_htgh','-kxx_htgh*TSx_htgh-kxy_htgh*TSy_htgh-kxz_htgh*TSz_htgh', ...
  'tflux_x_htgh','dflux_x_htgh+cflux_x_htgh', ...
  'cflux_y_htgh',0, ...
  'beta_y_htgh',0, ...
  'dflux_y_htgh','-kyx_htgh*TSx_htgh-kyy_htgh*TSy_htgh-kyz_htgh*TSz_htgh', ...
  'tflux_y_htgh','dflux_y_htgh+cflux_y_htgh', ...
  'cflux_z_htgh',0, ...
  'beta_z_htgh',0, ...
  'dflux_z_htgh','-kzx_htgh*TSx_htgh-kzy_htgh*TSy_htgh-kzz_htgh*TSz_htgh', ...
  'tflux_z_htgh','dflux_z_htgh+cflux_z_htgh', ...
  'dflux_htgh','sqrt(dflux_x_htgh^2+dflux_y_htgh^2+dflux_z_htgh^2)', ...
  'cflux_htgh','sqrt(cflux_x_htgh^2+cflux_y_htgh^2+cflux_z_htgh^2)', ...
  'tflux_htgh','sqrt(tflux_x_htgh^2+tflux_y_htgh^2+tflux_z_htgh^2)', ...
  'Dm_htgh','(kxx_htgh*beta_x_htgh^2+kxy_htgh*beta_x_htgh*beta_y_htgh+kxz_htgh*beta_x_htgh*beta_z_htgh+kyx_htgh*beta_y_htgh*beta_x_htgh+kyy_htgh*beta_y_htgh^2+kyz_htgh*beta_y_htgh*beta_z_htgh+kzx_htgh*beta_z_htgh*beta_x_htgh+kzy_htgh*beta_z_htgh*beta_y_htgh+kzz_htgh*beta_z_htgh^2)/(beta_x_htgh^2+beta_y_htgh^2+beta_z_htgh^2+eps)', ...
  'cellPe_htgh','0.5*h*sqrt(beta_x_htgh^2+beta_y_htgh^2+beta_z_htgh^2)/(Dm_htgh+eps)', ...
  'Qs_htgh','qs_htgh*T', ...
  'helem_htgh','h', ...
  'dr_guess_htgh',0, ...
  'R0_guess_htgh',0, ...
  'Sx_htgh','x', ...
  'S0x_guess_htgh',0, ...
  'Sdx_guess_htgh',0, ...
  'Sy_htgh','y', ...
  'S0y_guess_htgh',0, ...
  'Sdy_guess_htgh',0, ...
  'Sz_htgh','z', ...
  'S0z_guess_htgh',0, ...
  'Sdz_guess_htgh',0, ...
  'dVol_htgh','detJ_htgh', ...
  'TSx_htgh','Tx', ...
  'TSy_htgh','Ty', ...
  'TSz_htgh','Tz','convOn_htgh',0, ...
  'opacity_htgh',1, ...
  'rho_htgh',{200,8000}, ...
  'C_htgh',{2050,460}, ...
  'qs_htgh',0, ...
  'Q_htgh',{0,635500}, ...
  'gamma_htgh',1, ...
  'pA_htgh',101325, ...
  'QpworkOn_htgh',0, ...
  'QviscOn_htgh',0, ...
  'eta_htgh',1, ...
  'Rs_htgh',287, ...
  'Mn_htgh',0, ...
  'u_htgh',0, ...
  'v_htgh',0, ...
  'w_htgh',0, ...
  'etaT_htgh',1, ...
  'PrT_htgh',0.85, ...
  'ReInf_htgh',100000, ...
  'usedElement_htgh','Lag2', ...
  'finestMCelem_htgh','Lag2', ...
  'idon_htgh',0, ...
  'delid_htgh',0.5, ...
  'sdon_htgh',1, ...
  'sdtype_htgh','gls', ...
  'delsd_htgh',0.25, ...
  'cdon_htgh',0, ...
  'glim_htgh','0.01[K]/helem_htgh', ...
  'dr_htgh','dr_guess_htgh', ...
  'R0_htgh','R0_guess_htgh', ...
  'kxx_htgh',{0.1,160}, ...
  'kxy_htgh',0, ...
  'kxz_htgh',0, ...
  'kyx_htgh',0, ...
  'kyy_htgh',{0.2,160}, ...
  'kyz_htgh',0, ...
  'kzx_htgh',0, ...
  'kzy_htgh',0, ...
  'kzz_htgh',{0.3,160}, ...
  'ispml_htgh',0, ...
  'srcaxisx_htgh',0, ...
  'srcaxisy_htgh',0, ...
  'srcaxisz_htgh',1, ...
  'srcpntx_htgh',0, ...
  'srcpnty_htgh',0, ...
  'srcpntz_htgh',0, ...
  'userx_htgh',0, ...
  'usery_htgh',0, ...
  'userz_htgh',0, ...
  'Sdx_htgh','Sdx_guess_htgh', ...
  'Sdy_htgh','Sdy_guess_htgh', ...
  'Sdz_htgh','Sdz_guess_htgh', ...
  'S0x_htgh','S0x_guess_htgh', ...
  'S0y_htgh','S0y_guess_htgh', ...
  'S0z_htgh','S0z_guess_htgh', ...
  'detJ_htgh',1, ...
  'Jxx',1, ...
  'invJxx_htgh',1, ...
  'Jxy',0, ...
  'invJxy_htgh',0, ...
  'Jxz',0, ...
  'invJxz_htgh',0, ...
  'Jyx_htgh',0, ...
  'invJyx_htgh',0, ...
  'Jyy',1, ...
  'invJyy_htgh',1, ...
  'Jyz',0, ...
  'invJyz_htgh',0, ...
  'Jzx_htgh',0, ...
  'invJzx_htgh',0, ...
  'Jzy_htgh',0, ...
  'invJzy_htgh',0, ...
  'Jzz',1, ...
  'invJzz_htgh',1};
fem.equ = equ;

% Coupling variable elements
clear elemcpl
% Integration coupling variables
clear elem
elem.elem = 'elcplscalar';
elem.g = {'1'};
src = cell(1,1);
clear bnd
bnd.expr = {{{},'T'},{{},'1'}};
bnd.ipoints = {{{},'4'},{{},'4'}};
bnd.frame = {{{},'ref'},{{},'ref'}};
bnd.ind = {{'5','6','7','8','9','14'},{'1','2','3','4','10','11','12', ...
  '13'}};
src{1} = {{},{},bnd,{}};
elem.src = src;
geomdim = cell(1,1);
geomdim{1} = {};
elem.geomdim = geomdim;
elem.var = {'int_t_surf','a_surf'};
elem.global = {'1','2'};
elemcpl{1} = elem;
fem.elemcpl = elemcpl;

% ODE Settings
clear ode
clear units;
units.basesystem = 'SI';
ode.units = units;
fem.ode=ode;

% Multiphysics
fem=multiphysics(fem, ...
  'sdl',[]);

% Extend mesh
fem.xmesh=meshextend(fem);

% Solve problem
fem.sol=femtime(fem, ...
                'solcomp',{'T'}, ...
                'outcomp',{'T'}, ...
                'blocksize','auto', ...
                'tlist',[colon(0,0.1,1) colon(1,2,10) colon(10,20,100) colon(100,200,10000)], ...
                'tout','tlist', ...
                'stopcond','0.001 - int_t_surf/a_surf');

% Save current fem structure for restart purposes
fem0=fem;

% Plot solution
postplot(fem, ...
         'isodata',{'T','cont','internal','unit','K'}, ...
         'isolevels',5, ...
         'isomap','Rainbow', ...
         'isostriptol',0.01, ...
         'solnum','end', ...
         'title','Time=9900    Isosurface: Temperature [K]', ...
         'grid','on', ...
         'campos',[-3.652568628479838,-4.760120112678728,3.464101666756891], ...
         'camtarget',[0,0,0], ...
         'camup',[0,0,1], ...
         'camva',10.723703113869725);

% Plot solution
postplot(fem, ...
         'tetdata',{'T','cont','internal','unit','K'}, ...
         'tetmap','Rainbow', ...
         'tetkeep',1, ...
         'tetkeeptype','random', ...
         'solnum','end', ...
         'title','Time=9900    Subdomain: Temperature [K]', ...
         'grid','on', ...
         'campos',[-3.652568628479838,-4.760120112678728,3.464101666756891], ...
         'camtarget',[0,0,0], ...
         'camup',[0,0,1], ...
         'camva',10.72370311386969);

% Plot solution
postplot(fem, ...
         'tridata',{'T','cont','internal','unit','K'}, ...
         'trimap','Rainbow', ...
         'solnum','end', ...
         'title','Time=9900    Boundary: Temperature [K]', ...
         'grid','on', ...
         'campos',[0.037988755306063715,-6.583950468997911,2.156421690385302], ...
         'camtarget',[0,0,0], ...
         'camup',[-0.35088016398444133,0.28963868974947704,0.8905012857500307], ...
         'camva',10.723703113869657);

% Plot solution
postplot(fem, ...
         'slicedata',{'T','cont','internal','unit','K'}, ...
         'slicexspacing',5, ...
         'sliceyspacing',0, ...
         'slicezspacing',0, ...
         'slicemap','Rainbow', ...
         'solnum','end', ...
         'title','Time=9900    Slice: Temperature [K]', ...
         'grid','on', ...
         'campos',[0.037988755306063715,-6.583950468997911,2.156421690385302], ...
         'camtarget',[0,0,0], ...
         'camup',[-0.35088016398444133,0.28963868974947704,0.8905012857500307], ...
         'camva',10.723703113869536);

% Integrate
I1=postint(fem,'T', ...
           'unit','K', ...
           'recover','off', ...
           'dl',8, ...
           'edim',0, ...
           'solnum','end');

% Integrate
I2=postint(fem,'T', ...
           'unit','K', ...
           'recover','off', ...
           'dl',8, ...
           'edim',0, ...
           'solnum','end');

% Integrate
I3=postint(fem,'T', ...
           'unit','K', ...
           'recover','off', ...
           'dl',8, ...
           'edim',0, ...
           'solnum','end');

% Integrate
I4=postint(fem,'T', ...
           'unit','K', ...
           'recover','off', ...
           'dl',8, ...
           'edim',0, ...
           'solnum','end');

% Integrate
I5=postint(fem,'T', ...
           'unit','K', ...
           'recover','off', ...
           'dl',8, ...
           'edim',0, ...
           'solnum','end');

% Integrate
I6=postint(fem,'T', ...
           'unit','K', ...
           'recover','off', ...
           'dl',8, ...
           'edim',0, ...
           'solnum','end');
